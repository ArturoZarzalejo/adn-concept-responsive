var newPromise=function(){var t={resolveSuccess:function(){this.successFn?this.successFn(arguments[0]):this.successArguments=arguments[0]},resolveError:function(){this.errorFn&&this.errorFn(arguments[0])},then:function(){if(this.successFn=arguments[0]||!1,this.errorFn=arguments[1]||!1,this.successArguments){var t=this;setTimeout(function(){t.successFn(t.successArguments)},0)}}},e=function(){for(i in t)this[i]=t[i].bind(this)};return e}(),Components=function(){var t=arguments[0]||"../../api/components.php";outdated={},liveUpdate=!0,list={};var e={jsonp:function(){var t=new newPromise,e=new XMLHttpRequest;return e.open("POST",arguments[0],!0),e.send(JSON.stringify(arguments[1])||0),e.onload=function(){e.status>=200&&e.status<400?t.resolveSuccess(JSON.parse(e.response)):t.resolveError({status:e.status,statusText:e.statusText,responseURL:e.responseURL})},t},search:function(){return this.jsonp(t,{search:this._searchStringToObj(arguments[0]||""),limit:void 0===arguments[1]?20:arguments[1],offset:void 0===arguments[2]?0:arguments[2]})},get:function(){if(arguments[2])return this.getContainerData(arguments[0],arguments[1]||!1);arguments[1]=arguments[1]?arguments[1]:[];var e=arguments,r=new newPromise,n=[],o=[],i=arguments[0]&&arguments[0].constructor===Array?arguments[0]:[arguments[0]],s=i;return Array.prototype.forEach.call(s,function(){var t=arguments[0];if(void 0!==list[t]){var r=!1;Array.prototype.forEach.call(e[1].filter(function(t){return!(t in n)}),function(){(void 0===list[t][arguments[0]]||void 0!==outdated[t]&&outdated[t].indexOf(arguments[0])!==-1)&&(list[t][arguments[0]]=!1,n.push(arguments[0]),r=!0,void 0!==outdated[t]&&outdated[t].indexOf(arguments[0])!==-1&&outdated[t].splice(outdated[t].indexOf(arguments[0]),1))}),r||(i.splice(i.indexOf(arguments[0]),1),o.push(this._selectComponentFields(t,e[1])))}else n=e[1],list[t]={},Array.prototype.forEach.call(n,function(){list[t][arguments[0]]=!1})}.bind(this)),i.length?this.jsonp(t,{getComponents:i,select:n}).then(function(){Array.prototype.forEach.call(arguments[0],function(){this._mergeData(arguments[0]),o.push(this._selectComponentFields(arguments[0].comp_id,e[1]))}.bind(this)),r.resolveSuccess(o)}.bind(this),function(){r.resolveError(arguments[0])}):r.resolveSuccess(o),r},set:function(){var e=new newPromise,r=arguments[0]&&arguments[0].constructor===Array?arguments[0]:[arguments[0]];return this.jsonp(t,{setComponents:r}).then(function(){Array.prototype.forEach.call(arguments[0],function(){this._mergeData(arguments[0])}.bind(this)),e.resolveSuccess(arguments[0])},function(){e.resolveError(arguments[0])}),e},outdated:function(){var e=new newPromise,r=arguments[0].constructor===Array?arguments[0]:[arguments[0]],n=[];return Array.prototype.forEach.call(r,function(){var o=arguments[0];void 0!==list[o]&&(Array.prototype.forEach.call(list[o],function(){liveUpdate&&"comp_id"!==arguments[1]&&n.indexOf(arguments[1])===-1?n.push(arguments[1]):void 0===outdated[o]?outdated[o]=[arguments[1]]:outdated[o].indexOf(arguments[1])===-1&&outdated[o].push(arguments[1])}),liveUpdate&&this.jsonp(t,{getComponents:{comp_ids:r,select:n}}).then(function(){Array.prototype.forEach.call(arguments[0],function(){this._mergeData(arguments[0])}.bind(this)),e.resolveSuccess(arguments[0])},function(){console.log("liveUpdate"),e.resolveError(arguments[0])}))}),e},getContainerData:function(){var t=new newPromise,e=arguments[0].constructor===Array?arguments[0]:[arguments[0]],r=arguments[1]?arguments[1]:[];return this.get(e,r.indexOf("container")===-1?r.concat(["container"]):r).then(function(){var e=arguments,n=[];Array.prototype.forEach.call(arguments[0],function(){this._merge(n,this._containerToArray(arguments[0].container))}.bind(this)),this.get(n,r).then(function(){t.resolveSuccess(e[0])})}.bind(this)),t},_containerToArray:function(){var t=[];for(var e in arguments[0])"comp_id"in arguments[0][e]&&t.push(arguments[0][e].comp_id),"container"in arguments[0][e]&&(t=t.concat(this._containerToArray(arguments[0][e].container)));return t},_mergeData:function(){arguments[0].comp_id&&(void 0===list[arguments[0].comp_id]?list[arguments[0].comp_id]=arguments[0]:this._merge(list[arguments[0].comp_id],arguments[0]))},_selectComponentFields:function(){if(0===arguments[1].length)return list[arguments[0]];var t=arguments,e={comp_id:t[0]};return Array.prototype.forEach.call(t[1],function(){e[arguments[0]]=list[t[0]][arguments[0]]}),e},_merge:function(){for(var t in arguments[0])for(var e in arguments[1])arguments[0][e]=arguments[1][e];return arguments[0]},_searchStringToObj:function(){if(output={},input=arguments[0],void 0===input)return{other:""};for(parameters=input.match(/(\w+\:+\()|(\w+\:)/g);null!==parameters;){if(parameters[0].indexOf("(")===-1){var t=parameters[0].slice(0,parameters[0].length-1),e=new RegExp(parameters[0]+"([^\\s]+)","g"),r=input.match(e);null!==r&&(output[t]=r[0].replace(parameters[0],""))}else{var t=parameters[0].slice(0,parameters[0].length-2),e=new RegExp(t+"\\:\\((.*?)\\)|"+t+"\\:\\((.*?)$","g"),r=input.match(e);null!==r&&(output[t]=r[0].slice(0,r[0].length-1).replace(parameters[0],""))}null!==r?input=input.replace(r,""):input=input.replace(parameters[0],""),parameters=input.match(/(\w+\:+\()|(\w+\:)/g)}return output.other=input.trim(),output}},r=function(){for(i in e)this[i]=e[i]};return r}();